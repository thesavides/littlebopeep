# v1.4.0 Implementation Guide - Internationalization (i18n)

**Status**: Code Complete âœ… - Ready for Database Setup & Testing
**Date**: January 11, 2026
**Focus**: Database-driven multi-language support with AI translation

---

## ğŸ¯ What's New in v1.4.0

### Features Implemented:
1. âœ… **Database-driven translations** (Supabase tables)
2. âœ… **Four language support**: English, Welsh (Cymraeg), Irish Gaelic (Gaeilge), Scottish Gaelic (GÃ idhlig)
3. âœ… **AI-powered translation** using Claude API
4. âœ… **Translation caching** (24-hour localStorage cache)
5. âœ… **Language selector component** with flags and native names
6. âœ… **React hook** (`useTranslation()`) for easy component integration
7. âœ… **String interpolation** support ({variable} placeholders)
8. âœ… **Automatic language detection** from browser
9. âœ… **Translation verification** system
10. âœ… **Seed script** for batch translation generation

---

## ğŸ“ New Files Created

### 1. Database Schema
- `/supabase/migrations/001_translations_schema.sql` (400+ lines)
  - `languages` table
  - `translations` table
  - `translation_metadata` table
  - Helper functions (`get_translation`, `upsert_translation`, `get_all_translations`)
  - RLS policies
  - Indexes for performance

### 2. Translation Services
- `/src/lib/i18n.ts` (200+ lines)
  - Translation fetching and caching
  - Language management
  - String interpolation
  - Browser language detection

### 3. AI Translation
- `/src/lib/ai-translator.ts` (200+ lines)
  - Claude API integration
  - Batch translation processing
  - Translation verification
  - Variable preservation

### 4. React Hook
- `/src/hooks/useTranslation.ts` (130+ lines)
  - `t()` function for translations
  - `changeLanguage()` function
  - Loading and error states
  - Automatic fallback to English

### 5. UI Components
- `/src/components/LanguageSelector.tsx` (130+ lines)
  - Dropdown with flags
  - Native and English names
  - Keyboard accessible
  - Dark mode support

### 6. Seed Data
- `/src/lib/seed-translations.ts` (300+ lines)
  - 100+ English base translations
  - Organized by namespace (auth, walker, farmer, map, admin, etc.)
  - Context notes for translators

### 7. Seed Script
- `/scripts/seed-translations.ts` (150+ lines)
  - CLI tool for seeding database
  - AI translation generation
  - Translation verification

---

## ğŸ—„ï¸ Database Schema

### Languages Table
```sql
CREATE TABLE languages (
  code TEXT PRIMARY KEY,           -- 'en', 'cy', 'ga', 'gd'
  name_native TEXT NOT NULL,       -- 'Cymraeg', 'Gaeilge', etc.
  name_english TEXT NOT NULL,      -- 'Welsh', 'Irish', etc.
  flag_emoji TEXT,                 -- 'ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿', 'ğŸ‡®ğŸ‡ª', etc.
  enabled BOOLEAN DEFAULT true,
  display_order INTEGER DEFAULT 0
);
```

**Pre-seeded Languages**:
- ğŸ‡¬ğŸ‡§ English (en)
- ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ Welsh / Cymraeg (cy)
- ğŸ‡®ğŸ‡ª Irish / Gaeilge (ga)
- ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ Scottish Gaelic / GÃ idhlig (gd)

### Translations Table
```sql
CREATE TABLE translations (
  id UUID PRIMARY KEY,
  key TEXT NOT NULL,               -- 'auth.login.title'
  language_code TEXT NOT NULL,     -- 'en', 'cy', etc.
  value TEXT NOT NULL,             -- Translated string
  context TEXT,                    -- Optional translator notes
  namespace TEXT DEFAULT 'common', -- 'auth', 'walker', 'farmer', etc.
  UNIQUE(key, language_code)
);
```

### Translation Metadata Table
```sql
CREATE TABLE translation_metadata (
  translation_key TEXT NOT NULL,
  language_code TEXT NOT NULL,
  is_ai_generated BOOLEAN,         -- Auto-translated?
  is_verified BOOLEAN,             -- Human-verified?
  verified_by TEXT,
  verified_at TIMESTAMPTZ,
  notes TEXT
);
```

---

## ğŸš€ Installation & Setup

### Step 1: Run Supabase Migration

**Option A: Via Supabase Dashboard**
1. Go to https://supabase.com/dashboard/project/oyfikxdowpekmcxszbqg
2. Click "SQL Editor" in sidebar
3. Click "New Query"
4. Paste contents of `supabase/migrations/001_translations_schema.sql`
5. Click "Run" (bottom right)
6. Verify tables created: Database â†’ Tables â†’ `languages`, `translations`, `translation_metadata`

**Option B: Via Supabase CLI** (if installed)
```bash
supabase db push
```

### Step 2: Install Dependencies
```bash
cd /Users/chrissavides/Documents/littlebopeep-repo
npm install --legacy-peer-deps
npm install --save-dev ts-node @types/node
```

### Step 3: Seed English Translations
```bash
# Set Supabase credentials (if not already in .env)
export NEXT_PUBLIC_SUPABASE_URL=https://oyfikxdowpekmcxszbqg.supabase.co
export NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here

# Run seed script (English only, no AI translation)
npx ts-node scripts/seed-translations.ts
```

**Expected Output**:
```
ğŸš€ Starting translation seeding process...

ğŸ“ Seeding English translations...
âœ… Seeded 100+ English translations

ğŸ’¡ Run with --translate-all to generate AI translations for all languages
```

### Step 4: Generate AI Translations (Optional)

**Prerequisites**:
- Anthropic API key (Claude API)
- Get from: https://console.anthropic.com/settings/keys

**Generate All Languages**:
```bash
export ANTHROPIC_API_KEY=sk-ant-...

# Translate to Welsh, Irish, and Scottish Gaelic
npx ts-node scripts/seed-translations.ts --translate-all
```

**Or Translate Single Language**:
```bash
# Welsh only
npx ts-node scripts/seed-translations.ts --language=cy

# Irish only
npx ts-node scripts/seed-translations.ts --language=ga

# Scottish Gaelic only
npx ts-node scripts/seed-translations.ts --language=gd
```

**Expected Output**:
```
ğŸŒ Translating to CY...
Translating batch 1/3...
Translating batch 2/3...
Translating batch 3/3...
âœ… Translated 100 strings to CY
   Valid: 98, Invalid: 2
âœ… Inserted 100 CY translations into database
```

---

## ğŸ”§ Usage in Components

### Example 1: Basic Translation
```typescript
import { useTranslation } from '@/hooks/useTranslation'

export default function MyComponent() {
  const { t } = useTranslation()

  return (
    <div>
      <h1>{t('auth.signIn')}</h1>
      <p>{t('auth.welcomeMessage')}</p>
    </div>
  )
}
```

### Example 2: String Interpolation
```typescript
const { t } = useTranslation()

// Translation: "reports.sheepCount": "{count} sheep"
const message = t('reports.sheepCount', { count: 5 })
// Output: "5 sheep" (or "5 dafad" in Welsh)
```

### Example 3: Fallback Text
```typescript
const { t } = useTranslation()

const text = t('some.missing.key', {}, 'Default text if not found')
```

### Example 4: Language Switching
```typescript
const { language, changeLanguage, languages } = useTranslation()

return (
  <select value={language} onChange={(e) => changeLanguage(e.target.value)}>
    {languages.map(lang => (
      <option key={lang.code} value={lang.code}>
        {lang.flag_emoji} {lang.name_native}
      </option>
    ))}
  </select>
)
```

---

## ğŸ¨ Language Selector Component

### Add to Header
```typescript
// src/components/Header.tsx
import LanguageSelector from './LanguageSelector'

export default function Header() {
  return (
    <header>
      {/* ... other header content ... */}
      <LanguageSelector />
    </header>
  )
}
```

### Features:
- ğŸ¨ Beautiful dropdown with flags
- ğŸŒ™ Dark mode support
- âŒ¨ï¸ Keyboard accessible
- ğŸ“± Mobile responsive
- âœ… Shows selected language with checkmark

---

## ğŸ“Š Translation Organization

### Namespaces:
- `common` - Generic UI (save, cancel, submit, etc.)
- `auth` - Authentication (login, signup, password, etc.)
- `navigation` - Header, menu items
- `home` - Homepage content
- `walker` - Walker-specific UI
- `farmer` - Farmer-specific UI
- `map` - Map controls and disclaimers
- `admin` - Admin dashboard
- `reports` - Report status and details
- `errors` - Error messages

### Translation Key Format:
```
{namespace}.{feature}.{element}

Examples:
- auth.login.title
- walker.step1.title
- farmer.addFarm.button
- map.disclaimer.text1
```

---

## ğŸ§ª Testing

### Manual Testing:
1. Run app: `npm run dev`
2. Open http://localhost:3000
3. Look for language selector in header (top-right)
4. Click to open dropdown
5. Select Welsh (ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ Cymraeg)
6. UI should switch to Welsh
7. Try Irish and Scottish Gaelic
8. Verify translations persist after refresh

### Database Verification:
```sql
-- Check languages installed
SELECT * FROM languages ORDER BY display_order;

-- Check translation count per language
SELECT language_code, COUNT(*) as count
FROM translations
GROUP BY language_code;

-- Check sample translations
SELECT key, language_code, value
FROM translations
WHERE key = 'auth.signIn'
ORDER BY language_code;

-- Check AI-generated translations
SELECT tm.language_code, COUNT(*) as ai_count
FROM translation_metadata tm
WHERE is_ai_generated = true
GROUP BY tm.language_code;
```

---

## ğŸ” Troubleshooting

### Issue 1: Translations Not Loading
**Symptom**: UI shows translation keys instead of text
**Cause**: Database not seeded or cache issue
**Solution**:
```typescript
// Clear cache
localStorage.clear()

// Or in browser console:
Object.keys(localStorage)
  .filter(k => k.startsWith('translations_'))
  .forEach(k => localStorage.removeItem(k))
```

### Issue 2: Language Selector Not Showing
**Symptom**: No dropdown in header
**Cause**: Migration not run or languages table empty
**Solution**:
```sql
-- Verify languages table
SELECT * FROM languages;

-- If empty, run migration again
```

### Issue 3: AI Translation Fails
**Symptom**: Script errors during `--translate-all`
**Cause**: Missing or invalid Anthropic API key
**Solution**:
```bash
# Verify API key is set
echo $ANTHROPIC_API_KEY

# Should output: sk-ant-...
# If empty, set it:
export ANTHROPIC_API_KEY=sk-ant-your-key-here
```

### Issue 4: Variable Placeholders Not Working
**Symptom**: `{count}` shown literally instead of number
**Cause**: Not using params argument in `t()` function
**Solution**:
```typescript
// âŒ Wrong
t('reports.sheepCount')

// âœ… Correct
t('reports.sheepCount', { count: sheepCount })
```

---

## ğŸš€ Deployment

### Step 1: Commit Changes
```bash
git add .
git commit -m "feat: v1.4.0 - Internationalization with 4 language support

Add database-driven translations with AI-powered generation.

New files:
- supabase/migrations/001_translations_schema.sql
- src/lib/i18n.ts (translation service)
- src/lib/ai-translator.ts (Claude API integration)
- src/hooks/useTranslation.ts (React hook)
- src/components/LanguageSelector.tsx (UI component)
- src/lib/seed-translations.ts (English base)
- scripts/seed-translations.ts (CLI tool)

Features:
- English, Welsh, Irish Gaelic, Scottish Gaelic support
- 24-hour translation caching
- Automatic language detection
- String interpolation
- AI translation generation

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

### Step 2: Tag Release
```bash
git tag -a v1.4.0 -m "v1.4.0: Internationalization (i18n)

Database-driven translations with 4 language support.

Languages:
- English (en)
- Welsh / Cymraeg (cy)
- Irish / Gaeilge (ga)
- Scottish Gaelic / GÃ idhlig (gd)

Features:
- Supabase translation tables
- AI-powered translation (Claude API)
- React useTranslation hook
- LanguageSelector component
- 100+ UI strings translated
- 24-hour caching

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

### Step 3: Push to GitHub
```bash
git push origin main
git push origin v1.4.0
```

### Step 4: Run Migration in Production
1. Go to Supabase Dashboard (production project)
2. SQL Editor â†’ New Query
3. Paste `001_translations_schema.sql`
4. Click Run
5. Verify tables created

### Step 5: Seed Production Database
```bash
# On server or locally with production credentials
export NEXT_PUBLIC_SUPABASE_URL=https://oyfikxdowpekmcxszbqg.supabase.co
export NEXT_PUBLIC_SUPABASE_ANON_KEY=production_key
export ANTHROPIC_API_KEY=sk-ant-...

npx ts-node scripts/seed-translations.ts --translate-all
```

---

## ğŸ“ Next Steps After v1.4.0

### Immediate (Optional):
1. Manually verify AI translations with native speakers
2. Add more UI strings as components are updated
3. Create admin panel for managing translations
4. Add translation progress tracking

### Future Enhancements:
1. Crowdsource translation improvements
2. Add more languages (French, German, Spanish)
3. Implement translation memory
4. Add context screenshots for translators
5. Real-time translation updates (WebSocket)

---

## ğŸ“ Technical Details

### Why Database-Driven?
- Easy to add new languages without code changes
- Translators can update directly in database
- Supports versioning and approval workflows
- Scales to hundreds of languages

### Why Claude API for Translation?
- High-quality contextual translations
- Preserves technical terms and variable placeholders
- Understands cultural nuances
- Handles batch processing efficiently

### Why 24-Hour Cache?
- Reduces database queries (performance)
- Reduces API calls (cost)
- Translations rarely change daily
- Easy to invalidate on updates

### Why Namespace Organization?
- Easier to find related strings
- Supports lazy loading (load only needed namespaces)
- Clear separation of concerns
- Better for large applications

---

**End of v1.4.0 Implementation Guide**
